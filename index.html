<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marmaray Sefer Saatleri</title>
    <link rel="manifest" href="./manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans p-4 flex flex-col items-center min-h-screen">
    <div class="container mx-auto max-w-lg mt-8 mb-4 bg-white p-6 rounded-3xl shadow-2xl">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-center text-gray-800 mb-6 tracking-wide">
            Marmaray Sefer Saatleri
        </h1>
        <p class="text-center text-gray-600 mb-6">
            Başlangıç ve varış istasyonlarını seçerek sonraki sefer saatlerini görebilirsiniz.
        </p>

        <!-- Station Selection -->
        <div class="flex flex-col space-y-4 mb-6">
            <div>
                <label for="origin-station" class="block text-gray-700 font-bold mb-2">Başlangıç İstasyonu</label>
                <select id="origin-station" class="w-full p-3 border border-gray-300 rounded-xl bg-gray-50 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"></select>
            </div>
            
            <div class="flex justify-center">
                <button id="swap-button" class="bg-blue-200 text-blue-800 p-2 rounded-full hover:bg-blue-300 transition-transform transform hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                    </svg>
                </button>
            </div>

            <div>
                <label for="destination-station" class="block text-gray-700 font-bold mb-2">Varış İstasyonu</label>
                <select id="destination-station" class="w-full p-3 border border-gray-300 rounded-xl bg-gray-50 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"></select>
            </div>

            <button
                id="search-button"
                class="mt-4 w-full px-8 py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg hover:bg-blue-700 transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
            >
                Saatleri Bul
            </button>
        </div>

        <!-- Results Display -->
        <div id="results-container" class="mt-6 bg-gray-50 p-6 rounded-xl shadow-inner hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Sonraki Seferler</h2>
            <div id="schedule-list" class="space-y-3">
                <!-- Seferler buraya eklenecek -->
            </div>
            <p id="travel-time" class="mt-4 text-center text-gray-600 italic"></p>
        </div>

        <p id="status-message" class="mt-4 text-center text-red-500 font-medium"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const stations = [
                'Halkalı', 'Mustafa Kemal', 'Küçükçekmece', 'Menekşe', 'Florya', 'Florya Akvaryum',
                'Yeşilköy', 'Yeşilyurt', 'Ataköy', 'Bakırköy', 'Yenimahalle', 'Zeytinburnu',
                'Kazlıçeşme', 'Yenikapı', 'Sirkeci', 'Üsküdar', 'Ayrılık Çeşmesi', 'Söğütlüçeşme',
                'Feneryolu', 'Göztepe', 'Erenköy', 'Suadiye', 'Bostancı', 'Küçükyalı', 'İdealtepe',
                'Süreyya Plajı', 'Maltepe', 'Cevizli', 'Atalar', 'Başak', 'Kartal', 'Yunus', 'Pendik',
                'Kaynarca', 'Tersane', 'Güzelyalı', 'Aydıntepe', 'İçmeler', 'Tuzla', 'Çayırova',
                'Fatih', 'Osmangazi', 'Darıca', 'Gebze'
            ];

            const schedules = {};
            
            // Define train lines and their properties
            const trainLines = {
                'Halkalı-Gebze': {
                    startStation: 'Halkalı',
                    endStation: 'Gebze',
                    stations: stations,
                    firstDeparture: {
                         'Halkalı': '05:58',
                         'Mustafa Kemal': '06:01',
                         'Küçükçekmece': '06:03',
                         'Menekşe': '06:05',
                         'Florya': '06:08',
                         'Florya Akvaryum': '06:10',
                         'Yeşilköy': '06:12',
                         'Yeşilyurt': '06:14',
                         'Ataköy': '06:18',
                         'Bakırköy': '06:21',
                         'Yenimahalle': '06:23',
                         'Zeytinburnu': '06:26',
                         'Kazlıçeşme': '06:30',
                         'Yenikapı': '06:34',
                         'Sirkeci': '06:38',
                         'Üsküdar': '06:42',
                         'Ayrılık Çeşmesi': '06:45',
                         'Söğütlüçeşme': '06:48',
                         'Feneryolu': '06:50',
                         'Göztepe': '06:52',
                         'Erenköy': '06:54',
                         'Suadiye': '06:56',
                         'Bostancı': '06:59',
                         'Küçükyalı': '07:01',
                         'İdealtepe': '07:03',
                         'Süreyya Plajı': '07:05',
                         'Maltepe': '07:07',
                         'Cevizli': '07:09',
                         'Atalar': '07:11',
                         'Başak': '07:13',
                         'Kartal': '07:15',
                         'Yunus': '07:17',
                         'Pendik': '07:20',
                         'Kaynarca': '07:22',
                         'Tersane': '07:24',
                         'Güzelyalı': '07:26',
                         'Aydıntepe': '07:28',
                         'İçmeler': '07:30',
                         'Tuzla': '07:32',
                         'Çayırova': '07:35',
                         'Fatih': '07:37',
                         'Osmangazi': '07:39',
                         'Darıca': '07:41',
                         'Gebze': '07:44',
                    }
                },
                'Ataköy-Pendik': {
                    startStation: 'Ataköy',
                    endStation: 'Pendik',
                    stations: stations.slice(stations.indexOf('Ataköy'), stations.indexOf('Pendik') + 1),
                    firstDeparture: {
                        'Ataköy': '06:09',
                        'Bakırköy': '06:12',
                        'Yenimahalle': '06:13',
                        'Zeytinburnu': '06:16',
                        'Kazlıçeşme': '06:20',
                        'Yenikapı': '06:24',
                        'Sirkeci': '06:28',
                        'Üsküdar': '06:32',
                        'Ayrılık Çeşmesi': '06:35',
                        'Söğütlüçeşme': '06:38',
                        'Feneryolu': '06:40',
                        'Göztepe': '06:42',
                        'Erenköy': '06:44',
                        'Suadiye': '06:46',
                        'Bostancı': '06:49',
                        'Küçükyalı': '06:51',
                        'İdealtepe': '06:53',
                        'Süreyya Plajı': '06:55',
                        'Maltepe': '06:57',
                        'Cevizli': '06:59',
                        'Atalar': '07:01',
                        'Başak': '07:03',
                        'Kartal': '07:05',
                        'Yunus': '07:07',
                        'Pendik': '07:10',
                    }
                },
                'Gebze-Halkalı': {
                    startStation: 'Gebze',
                    endStation: 'Halkalı',
                    stations: stations.slice().reverse(),
                     firstDeparture: {
                        'Gebze': '06:05',
                        'Darıca': '06:08',
                        'Osmangazi': '06:10',
                        'Fatih': '06:13',
                        'Çayırova': '06:15',
                        'Tuzla': '06:18',
                        'İçmeler': '06:20',
                        'Aydıntepe': '06:22',
                        'Güzelyalı': '06:24',
                        'Tersane': '06:26',
                        'Kaynarca': '06:28',
                        'Pendik': '06:31',
                        'Yunus': '06:34',
                        'Kartal': '06:37',
                        'Başak': '06:39',
                        'Atalar': '06:41',
                        'Cevizli': '06:43',
                        'Maltepe': '06:46',
                        'Süreyya Plajı': '06:48',
                        'İdealtepe': '06:50',
                        'Küçükyalı': '06:52',
                        'Bostancı': '06:55',
                        'Suadiye': '06:57',
                        'Erenköy': '06:59',
                        'Göztepe': '07:01',
                        'Feneryolu': '07:03',
                        'Söğütlüçeşme': '07:06',
                        'Ayrılık Çeşmesi': '07:09',
                        'Üsküdar': '07:13',
                        'Sirkeci': '07:17',
                        'Yenikapı': '07:21',
                        'Kazlıçeşme': '07:25',
                        'Zeytinburnu': '07:28',
                        'Yenimahalle': '07:30',
                        'Bakırköy': '07:32',
                        'Ataköy': '07:35',
                        'Yeşilyurt': '07:37',
                        'Yeşilköy': '07:39',
                        'Florya Akvaryum': '07:41',
                        'Florya': '07:43',
                        'Menekşe': '07:46',
                        'Küçükçekmece': '07:48',
                        'Mustafa Kemal': '07:50',
                        'Halkalı': '07:53',
                     }
                },
                'Pendik-Ataköy': {
                    startStation: 'Pendik',
                    endStation: 'Ataköy',
                    stations: stations.slice(stations.indexOf('Pendik'), stations.indexOf('Ataköy') + 1).reverse(),
                    firstDeparture: {
                        'Pendik': '06:09',
                        'Yunus': '06:12',
                        'Kartal': '06:15',
                        'Başak': '06:17',
                        'Atalar': '06:19',
                        'Cevizli': '06:21',
                        'Maltepe': '06:24',
                        'Süreyya Plajı': '06:26',
                        'İdealtepe': '06:28',
                        'Küçükyalı': '06:30',
                        'Bostancı': '06:33',
                        'Suadiye': '06:35',
                        'Erenköy': '06:37',
                        'Göztepe': '06:40',
                        'Feneryolu': '06:42',
                        'Söğütlüçeşme': '06:45',
                        'Ayrılık Çeşmesi': '06:48',
                        'Üsküdar': '06:52',
                        'Sirkeci': '06:56',
                        'Yenikapı': '07:00',
                        'Kazlıçeşme': '07:04',
                        'Zeytinburnu': '07:07',
                        'Yenimahalle': '07:09',
                        'Bakırköy': '07:11',
                        'Ataköy': '07:14',
                    }
                }
            };
            
            // Populate select options
            const originSelect = document.getElementById('origin-station');
            const destinationSelect = document.getElementById('destination-station');

            stations.forEach(station => {
                const option1 = document.createElement('option');
                option1.value = station;
                option1.textContent = station;
                originSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = station;
                option2.textContent = station;
                destinationSelect.appendChild(option2);
            });

            // Swap button functionality
            document.getElementById('swap-button').addEventListener('click', () => {
                const originValue = originSelect.value;
                originSelect.value = destinationSelect.value;
                destinationSelect.value = originValue;
            });
            
            function calculateTravelTime(origin, destination, lineStations) {
                const originIndex = lineStations.indexOf(origin);
                const destinationIndex = lineStations.indexOf(destination);

                if (originIndex === -1 || destinationIndex === -1) {
                    return null;
                }

                const diff = Math.abs(originIndex - destinationIndex);
                // Each station takes approximately 2 minutes travel time
                // This is a simplified calculation and not official data.
                return diff * 2; 
            }

            function getTrainSchedule(origin, destination) {
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();
                const currentTimeInMinutes = currentHour * 60 + currentMinute;
                
                let schedules = [];
                let frequency = 15; // default frequency

                const day = now.getDay(); // 0 for Sunday, 1 for Monday, etc.

                // Check for weekend night service (Friday/Saturday night)
                const isWeekendNight = (day === 5 && currentHour >= 22) || (day === 6);
                
                if (isWeekendNight) {
                    frequency = 20; // 20 minutes frequency after 22:00 on Friday/Saturday
                } else if (
                    (currentHour >= 7 && currentHour < 10) ||
                    (currentHour >= 16 && currentHour < 20)
                ) {
                    frequency = 8; // Peak hours frequency
                }
                
                for (const lineName in trainLines) {
                    const line = trainLines[lineName];
                    const originIndex = line.stations.indexOf(origin);
                    const destinationIndex = line.stations.indexOf(destination);

                    if (originIndex !== -1 && destinationIndex !== -1) {
                        const firstDeparture = line.firstDeparture[origin];
                        if (firstDeparture) {
                            const [firstDepHour, firstDepMinute] = firstDeparture.split(':').map(Number);
                            let firstDepInMinutes = firstDepHour * 60 + firstDepMinute;
                            
                            // Check if current time is before the last train of the day
                            // A simple check to avoid infinite loops
                            if (currentTimeInMinutes > (23 * 60)) {
                                continue;
                            }

                            // Calculate next departure times
                            let nextDepartureTimeInMinutes = firstDepInMinutes;
                            while (nextDepartureTimeInMinutes < currentTimeInMinutes) {
                                nextDepartureTimeInMinutes += frequency;
                            }

                            for (let i = 0; i < 5; i++) {
                                const departure = nextDepartureTimeInMinutes + i * frequency;
                                const departureHour = Math.floor(departure / 60) % 24;
                                const departureMinute = departure % 60;
                                
                                // Calculate arrival time for this specific train and line
                                const travelTime = calculateTravelTime(origin, destination, line.stations);
                                if (travelTime !== null) {
                                    const arrival = departure + travelTime;
                                    const arrivalHour = Math.floor(arrival / 60) % 24;
                                    const arrivalMinute = arrival % 60;

                                    schedules.push({
                                        departure: `${String(departureHour).padStart(2, '0')}:${String(departureMinute).padStart(2, '0')}`,
                                        arrival: `${String(arrivalHour).padStart(2, '0')}:${String(arrivalMinute).padStart(2, '0')}`,
                                        line: lineName
                                    });
                                }
                            }
                        }
                    }
                }
                
                // Sort by departure time
                schedules.sort((a, b) => {
                    const aTime = parseInt(a.departure.replace(':', ''));
                    const bTime = parseInt(b.departure.replace(':', ''));
                    return aTime - bTime;
                });
                
                return schedules;
            }

            document.getElementById('search-button').addEventListener('click', () => {
                const origin = originSelect.value;
                const destination = destinationSelect.value;
                const scheduleList = document.getElementById('schedule-list');
                const resultsContainer = document.getElementById('results-container');
                const statusMessage = document.getElementById('status-message');

                statusMessage.textContent = '';
                scheduleList.innerHTML = '';
                resultsContainer.classList.add('hidden');

                if (origin === destination) {
                    statusMessage.textContent = 'Başlangıç ve varış istasyonları aynı olamaz.';
                    return;
                }

                const travelTime = calculateTravelTime(origin, destination, stations);

                if (travelTime === null) {
                     statusMessage.textContent = 'Seçtiğiniz istasyonlar aynı hat üzerinde değil.';
                     return;
                }

                document.getElementById('travel-time').textContent = `Tahmini seyahat süresi: ${travelTime} dakika`;

                const schedules = getTrainSchedule(origin, destination);
                
                if (schedules.length > 0) {
                    schedules.forEach(schedule => {
                        const scheduleItem = document.createElement('div');
                        scheduleItem.className = 'p-3 bg-white rounded-xl shadow-md flex justify-between items-center';
                        scheduleItem.innerHTML = `
                            <div class="flex-1">
                                <p class="text-xl font-bold text-blue-600">${schedule.departure}</p>
                                <p class="text-sm text-gray-500">${schedule.line}</p>
                            </div>
                            <div class="text-center mx-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                                </svg>
                            </div>
                            <div class="flex-1 text-right">
                                <p class="text-xl font-bold text-gray-800">${schedule.arrival}</p>
                            </div>
                        `;
                        scheduleList.appendChild(scheduleItem);
                    });
                    resultsContainer.classList.remove('hidden');
                } else {
                    statusMessage.textContent = 'Bugün için sefer bulunamadı. Lütfen sefer saatlerini kontrol edin.';
                }
            });
        });
    </script>
</body>
</html>
